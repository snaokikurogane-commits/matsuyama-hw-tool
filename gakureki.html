<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ハローワーク松山 業務支援ツール</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; line-height: 1.6; padding: 10px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { font-size: 1.1rem; text-align: center; color: #0056b3; border-bottom: 2px solid #e3f2fd; padding-bottom: 10px; margin-top: 0; }
        
        /* タブデザイン */
        .tab-menu { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        .tab-btn { flex: 1; min-width: 80px; padding: 8px 4px; border: 1px solid #0056b3; background: white; color: #0056b3; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .tab-btn.active { background: #0056b3; color: white; }
        
        .section { background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #cce5ff; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.85rem; }
        input, select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; margin-bottom: 10px; }
        
        .result-box { background: #fff3e0; padding: 15px; border-radius: 8px; border: 1px solid #ffe0b2; margin-top: 10px; }
        .result-title { font-size: 0.9rem; color: #e65100; margin: 0 0 10px 0; font-weight: bold; border-bottom: 1px dashed #e65100; padding-bottom: 5px; }
        
        /* ToDoリスト用 */
        .todo-item { display: flex; align-items: flex-start; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
        .todo-date { min-width: 90px; font-weight: bold; color: #d81b60; font-size: 0.9rem; }
        .todo-content { flex: 1; font-size: 0.9rem; }
        .todo-badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: white; margin-bottom: 4px; }
        .bg-city { background-color: #4caf50; } /* 市役所 */
        .bg-hw { background-color: #2196f3; } /* ハローワーク */
        .bg-tax { background-color: #ff9800; } /* 税金 */
        .bg-ins { background-color: #9c27b0; } /* 社保 */

        .sim-val { font-size: 1.1rem; font-weight: bold; color: #333; }
        .wall-check { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .status-safe { color: #2e7d32; font-weight: bold; background:#e8f5e9; padding:2px 6px; border-radius:4px; }
        .status-danger { color: #c62828; font-weight: bold; background:#ffebee; padding:2px 6px; border-radius:4px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 8px; text-align: left; }
        th { background-color: #e3f2fd; color: #0d47a1; }
        
        .disclaimer { margin-top: 20px; padding: 10px; border: 1px solid #eee; border-radius: 6px; background: #fff; font-size: 0.7rem; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>業務支援ツール（統合版）</h1>

    <div class="tab-menu">
        <button class="tab-btn active" onclick="showTab('todo')">手続きToDo</button>
        <button class="tab-btn" onclick="showTab('sim')">再就職シミュ</button>
        <button class="tab-btn" onclick="showTab('fuyou')">扶養判定</button>
        <button class="tab-btn" onclick="showTab('benefit')">給付/再就職</button>
        <button class="tab-btn" onclick="showTab('edu')">学歴/期間</button>
    </div>

    <div id="tab-todo" class="tab-content">
        <div class="section">
            <label>離職日 (退職した日)</label>
            <input type="date" id="todoResignDate" onchange="calcTodo()">
            <p style="font-size:0.8rem; color:#666; margin:5px 0 0;">
                ※雇用保険の日額が <strong>3,612円</strong> (60歳以上は5,000円) を超える場合、給付期間中は社会保険の扶養に入れません。
            </p>
        </div>

        <div id="todoResult" class="result-box" style="display:none; background:#fff;">
            <p class="result-title">離職後の手続き期限リスト</p>
            <div id="todoListBody"></div>
        </div>
    </div>

    <div id="tab-sim" class="tab-content" style="display:none;">
        <div class="section">
            <p style="margin-top:0; color:#0277bd; font-weight:bold;">現在の状況</p>
            <div style="display:flex; gap:10px;">
                <div style="flex:1;">
                    <label>所定給付日数</label>
                    <select id="simTotalDays" onchange="calcSim()">
                        <option value="90">90日</option>
                        <option value="120">120日</option>
                        <option value="150">150日</option>
                        <option value="180">180日</option>
                        <option value="210">210日</option>
                        <option value="240">240日</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label>現在の残日数</label>
                    <input type="number" id="simCurrentRemain" placeholder="例: 60" oninput="calcSim()">
                </div>
            </div>
            <label>直近の認定日</label>
            <input type="date" id="simLastCertDate" onchange="calcSim()">
            <hr style="border:0; border-top:1px dashed #ccc; margin:15px 0;">
            <p style="margin-top:0; color:#d81b60; font-weight:bold;">就職予定日 (仮)</p>
            <input type="date" id="simStartDate" onchange="calcSim()">
        </div>
        <div id="simResult" class="result-box" style="display:none; background:#fff;">
            <p class="result-title">シミュレーション結果</p>
            <div style="margin-bottom:10px;">
                <div style="font-size:0.85rem; color:#0277bd;">① 就職日の前日まで (基本手当)</div>
                <div class="sim-val"><span id="simBasicDays">0</span> 日分 支給</div>
                <div style="font-size:0.8rem; color:#666;" id="simBasicPeriod">---</div>
            </div>
            <div style="margin-bottom:10px;">
                <div style="font-size:0.85rem; color:#d81b60;">② 就職前日時点の残日数</div>
                <div class="sim-val"><span id="simFinalRemain">0</span> 日</div>
            </div>
            <div style="border-top:1px dashed #ddd; padding-top:10px;">
                <div style="font-size:0.85rem; color:#333;">③ 再就職手当の判定</div>
                <div id="simVerdict" class="sim-val" style="color:#0277bd;">---</div>
                <div id="simVerdictDetail" style="font-size:0.8rem; color:#666;">---</div>
            </div>
        </div>
    </div>

    <div id="tab-fuyou" class="tab-content" style="display:none;">
        <div class="section">
            <label>時給(円)</label><input type="number" id="wage" placeholder="1050" oninput="calcFuyou()">
            <div id="minWageAlert" style="display:none; color:#d32f2f; font-size:0.75rem;">※愛媛県最低賃金(956円)未満です</div>
            <div style="display:flex; gap:10px;">
                <div style="flex:1;"><label>1日時間</label><input type="number" id="hoursDay" placeholder="5" oninput="calcFuyou()"></div>
                <div style="flex:1;"><label>週日数</label><input type="number" id="daysWeek" placeholder="3" oninput="calcFuyou()"></div>
            </div>
            <label style="color:#d32f2f;">交通費(月額)</label><input type="number" id="transport" placeholder="5000" oninput="calcFuyou()">
        </div>
        <div id="fuyouResult" class="result-box" style="display:none; background:#fff;">
            <p class="result-title">見込み年収判定</p>
            <div style="margin-bottom:10px;">
                <div>月収(交通費込): <span id="totalMonthly" style="font-weight:bold;">0</span> 円</div>
                <div>年収(交通費込): <span id="totalYearly" style="font-weight:bold;">0</span> 円</div>
            </div>
            <div class="wall-check"><span>103万(税金/交通費抜)</span><span id="wall103">---</span></div>
            <div class="wall-check"><span>106万(社保/交通費抜)</span><span id="wall106">---</span></div>
            <div class="wall-check"><span>130万(扶養/交通費込)</span><span id="wall130">---</span></div>
            <p style="font-size:0.7rem; color:#666; margin-top:5px;">※130万の壁は「向こう1年間の見込み」で交通費も含みます。</p>
        </div>
    </div>

    <div id="tab-edu" class="tab-content" style="display:none;">
        <div class="section">
            <label>生まれた西暦</label><input type="number" id="birthYear" placeholder="1995" oninput="calcEdu()">
            <label style="font-weight:normal;"><input type="checkbox" id="isEarly" onchange="calcEdu()"> 早生まれ</label>
        </div>
        <div id="eduResult" style="display:none;">
            <table><tbody id="eduTableBody"></tbody></table>
        </div>
        <div class="section" style="margin-top:15px;">
            <label>入社日</label><input type="date" id="startD" onchange="calcPeriod()">
            <label>退職日</label><input type="date" id="endD" onchange="calcPeriod()">
        </div>
        <div id="periodResult" class="result-box" style="display:none;">
            <p class="result-title">勤続期間</p>
            <div id="periodVal" class="sim-val"></div>
        </div>
    </div>
    
    <div id="tab-benefit" class="tab-content" style="display:none;">
        <div class="section">
            <label>年齢</label><input type="number" id="ageAtLeft" oninput="calcBenefit()">
            <label>期間</label>
            <select id="insPeriod" onchange="calcBenefit()">
                <option value="0">1年未満</option><option value="1">1年以上</option><option value="10">10年以上</option><option value="20">20年以上</option>
            </select>
            <label>理由</label>
            <select id="leftReason" onchange="calcBenefit()">
                <option value="general">自己都合</option><option value="special">会社都合</option>
            </select>
        </div>
        <div id="benefitResult" class="result-box" style="display:none;">
            <p class="result-title">所定給付日数</p>
            <div id="benefitVal" class="sim-val"></div>
        </div>
    </div>

    <div class="disclaimer">
        <strong>免責事項</strong>
        <ul>
            <li>本ツールは目安です。正確な手続き期限や扶養判定は、市役所・年金事務所・健保組合等へご確認ください。</li>
            <li>利用による損害について、<strong>ハローワーク松山</strong>は一切責任を負いません。</li>
        </ul>
    </div>
</div>

<script>
function showTab(name) {
    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + name).style.display = 'block';
    const btns = document.getElementsByClassName('tab-btn');
    for(let i=0; i<btns.length; i++) {
        if(btns[i].getAttribute('onclick').includes(name)) btns[i].classList.add('active');
    }
}

// --- 1. 手続きToDoリスト (NEW) ---
function calcTodo() {
    const dStr = document.getElementById('todoResignDate').value;
    if (!dStr) { document.getElementById('todoResult').style.display = 'none'; return; }
    
    const d = new Date(dStr);
    const fmt = (date) => `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}`;
    const addDays = (date, days) => { const r = new Date(date); r.setDate(r.getDate() + days); return r; };

    const limit14 = addDays(d, 14); // 14日以内
    const limit20 = addDays(d, 20); // 20日以内

    const items = [
        {
            tag: "市役所", cls: "bg-city", date: limit14,
            text: "<strong>国民健康保険への切替</strong><br>※任意継続しない場合。離職票や資格喪失証明書が必要。"
        },
        {
            tag: "市役所", cls: "bg-city", date: limit14,
            text: "<strong>国民年金への切替 (第1号被保険者)</strong><br>※20歳以上60歳未満の方。年金手帳と離職票が必要。"
        },
        {
            tag: "健保組合", cls: "bg-ins", date: limit20,
            text: "<strong>健康保険の任意継続 (希望者のみ)</strong><br>※退職後20日以内に手続き必須。保険料は全額自己負担(約2倍)になります。"
        },
        {
            tag: "税金", cls: "bg-tax", date: null,
            text: "<strong>住民税の支払い</strong><br>※給与天引きから普通徴収(納付書払い)に変わります。後日、市役所から通知が届きます。"
        },
        {
            tag: "扶養", cls: "bg-ins", date: null,
            text: "<strong>家族の扶養に入る場合</strong><br>※雇用保険の日額が<strong>3,612円</strong>を超える場合、受給期間中は扶養に入れません。<br>受給終了後に手続きが必要です。"
        }
    ];

    let html = "";
    items.forEach(item => {
        const dateStr = item.date ? `期限: ${fmt(item.date)}` : "随時/後日";
        html += `
        <div class="todo-item">
            <div class="todo-date">${dateStr}</div>
            <div class="todo-content">
                <span class="todo-badge ${item.cls}">${item.tag}</span><br>
                ${item.text}
            </div>
        </div>`;
    });

    document.getElementById('todoResult').style.display = 'block';
    document.getElementById('todoListBody').innerHTML = html;
}

// --- 2. 再就職シミュ (省略なし) ---
function calcSim() {
    const total = parseInt(document.getElementById('simTotalDays').value);
    const currentRemain = parseInt(document.getElementById('simCurrentRemain').value);
    const lastCertStr = document.getElementById('simLastCertDate').value;
    const startStr = document.getElementById('simStartDate').value;
    const resultBox = document.getElementById('simResult');
    
    if (!total || !currentRemain || !lastCertStr || !startStr) { resultBox.style.display = 'none'; return; }

    const lastCertDate = new Date(lastCertStr);
    const startDate = new Date(startStr);
    const diffTime = startDate - lastCertDate;
    const daysToPay = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) - 1;

    if (daysToPay < 0) { resultBox.style.display = 'none'; return; }
    resultBox.style.display = 'block';

    document.getElementById('simBasicDays').innerText = daysToPay;
    const periodStart = new Date(lastCertDate); periodStart.setDate(periodStart.getDate() + 1);
    const periodEnd = new Date(startDate); periodEnd.setDate(periodEnd.getDate() - 1);
    const fmt = (d) => `${d.getMonth()+1}/${d.getDate()}`;
    document.getElementById('simBasicPeriod').innerText = `${fmt(periodStart)} 〜 ${fmt(periodEnd)}`;

    const finalRemain = currentRemain - daysToPay;
    document.getElementById('simFinalRemain').innerText = finalRemain < 0 ? "0 (終了)" : finalRemain;
    
    const ratio = finalRemain / total;
    let rate = 0;
    if (finalRemain > 0) {
        if (ratio >= 2/3) rate = 70; else if (ratio >= 1/3) rate = 60;
    }
    const vEl = document.getElementById('simVerdict');
    const dEl = document.getElementById('simVerdictDetail');
    if (rate > 0) {
        vEl.innerText = `支給対象 (${rate}%)`; vEl.style.color = "#2e7d32";
        dEl.innerText = `残日数${finalRemain}日が所定${total}日の1/3以上です。`;
    } else {
        vEl.innerText = "支給なし"; vEl.style.color = "#d32f2f";
        dEl.innerText = "残日数が足りないか、マイナスです。";
    }
}

// --- 3. 扶養判定 (省略なし) ---
function calcFuyou() {
    const wage = parseInt(document.getElementById('wage').value);
    const hDay = parseFloat(document.getElementById('hoursDay').value);
    const dWeek = parseFloat(document.getElementById('daysWeek').value);
    const trans = parseInt(document.getElementById('transport').value) || 0;

    if(wage && wage < 956) document.getElementById('minWageAlert').style.display = 'block';
    else document.getElementById('minWageAlert').style.display = 'none';

    if (!wage || !hDay || !dWeek) { document.getElementById('fuyouResult').style.display = 'none'; return; }

    const baseMonthly = Math.floor(wage * hDay * 4.33 * dWeek); 
    const totalMonthly = baseMonthly + trans;
    const baseYearly = baseMonthly * 12; 
    const totalYearly = totalMonthly * 12; 

    document.getElementById('fuyouResult').style.display = 'block';
    document.getElementById('totalMonthly').innerText = totalMonthly.toLocaleString();
    document.getElementById('totalYearly').innerText = totalYearly.toLocaleString();

    const setStatus = (id, limit, val, type) => {
        const el = document.getElementById(id);
        if (val < limit) { el.innerText = "範囲内"; el.className = "status-safe"; }
        else { el.innerText = type===106?"要確認":"超過"; el.className = type===106?"status-warn":"status-danger"; }
    };
    setStatus('wall103', 1030000, baseYearly);
    setStatus('wall106', 88000, baseMonthly, 106);
    setStatus('wall130', 1300000, totalYearly);
}

// --- 4. 学歴/期間 (既存) ---
function getW(y) {
    if (y >= 2019) return `令和${y-2018==1?'元':y-2018}年`;
    if (y >= 1989) return `平成${y-1988==1?'元':y-1988}年`;
    if (y >= 1926) return `昭和${y-1925==1?'元':y-1925}年`;
    return y + "年";
}
function calcEdu() {
    const y = parseInt(document.getElementById('birthYear').value);
    if (!y) return;
    document.getElementById('eduResult').style.display = 'block';
    const base = document.getElementById('isEarly').checked ? y - 1 : y;
    const list = [ {l:"中卒", o:16, m:3}, {l:"高卒", o:19, m:3}, {l:"大卒", o:23, m:3} ];
    let h = ""; list.forEach(i => { h += `<tr><td>${i.l}</td><td>${i.o+base}年(${getW(i.o+base)})${i.m}月</td></tr>`; });
    document.getElementById('eduTableBody').innerHTML = h;
}
function calcPeriod() {
    const s = new Date(document.getElementById('startD').value);
    const e = new Date(document.getElementById('endD').value);
    if (isNaN(s) || isNaN(e)) return;
    let yy = e.getFullYear() - s.getFullYear();
    let mm = e.getMonth() - s.getMonth();
    let dd = e.getDate() - s.getDate();
    if (dd < 0) { mm--; const last = new Date(e.getFullYear(), e.getMonth(), 0); dd += last.getDate(); }
    if (mm < 0) { yy--; mm += 12; }
    document.getElementById('periodResult').style.display = 'block';
    document.getElementById('periodVal').innerText = yy < 0 ? "エラー" : `${yy}年 ${mm}ヶ月 ${dd}日`;
}
// --- 5. 給付日数 (既存) ---
function calcBenefit() {
    const age = parseInt(document.getElementById('ageAtLeft').value);
    const ins = parseInt(document.getElementById('insPeriod').value);
    const res = document.getElementById('leftReason').value;
    if (!age) return;
    let days = 0;
    if (res === "general") {
        if (ins >= 20) days = 150; else if (ins >= 10) days = 120; else if (ins >= 1) days = 90;
    } else {
        if (age < 30) days = ins>=5 ? 120 : 90;
        else if (age < 35) days = ins>=10 ? 210 : (ins>=5 ? 180 : 120);
        else if (age < 45) days = ins>=20 ? 270 : (ins>=10 ? 240 : (ins>=5 ? 180 : 150));
        else if (age < 60) days = ins>=20 ? 330 : (ins>=10 ? 270 : (ins>=5 ? 240 : 180));
        else days = ins>=20 ? 240 : (ins>=10 ? 210 : (ins>=5 ? 180 : 150));
    }
    document.getElementById('benefitResult').style.display = 'block';
    document.getElementById('benefitVal').innerText = days + "日";
}
</script>
</body>
</html>
