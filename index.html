<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>再就職手当 計算ツール</title>
    <style>
        body { 
            font-family: -apple-system, "Helvetica Neue", Arial, sans-serif; 
            background-color: #f0f4f8; 
            padding: 10px; 
            margin: 0; 
            display: flex;
            justify-content: center;
        }
        .card { 
            width: 100%; 
            max-width: 480px; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            box-sizing: border-box;
            margin-top: 10px;
        }
        h2 { color: #00529b; text-align: center; font-size: 1.3rem; margin-top: 0; border-bottom: 2px solid #00529b; padding-bottom: 10px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; }
        input, select { 
            width: 100%; 
            padding: 12px; 
            font-size: 16px; /* iPhoneでのズーム防止 */
            border: 1px solid #ccd6e0; 
            border-radius: 8px; 
            box-sizing: border-box; 
        }
        /* 入力エラー時の強調 */
        .error-border { border: 2px solid #ff4d4d; background-color: #fff0f0; }

        button { 
            width: 100%; 
            padding: 16px; 
            background-color: #00b900; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            cursor: pointer;
            margin-top: 10px;
        }
        .result-box { margin-top: 20px; padding: 15px; background-color: #eef9ee; border: 2px solid #c2e6c2; border-radius: 10px; display: none; }
        .res-value { font-size: 1.8rem; font-weight: 900; color: #d32f2f; text-align: center; margin: 10px 0; }
        .footer-note { font-size: 0.75rem; color: #666; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; line-height: 1.5; }
        .highlight { color: #00529b; font-weight: bold; }
    </style>
</head>
<body>
<div class="card">
    <h2>再就職手当 計算ツール</h2>
    <div class="input-group">
        <label>離職時の年齢区分</label>
        <select id="ageGroup">
            <option value="under30">30歳未満</option>
            <option value="30to44">30歳以上 45歳未満</option>
            <option value="45to59">45歳以上 60歳未満</option>
            <option value="60to64">60歳以上 65歳未満</option>
        </select>
    </div>
    <div class="input-group">
        <label>所定給付日数（日）</label>
        <select id="totalDays" onchange="checkLimit()">
            <option value="90">90日</option>
            <option value="120">120日</option>
            <option value="150">150日</option>
            <option value="180">180日</option>
            <option value="210">210日</option>
            <option value="240">240日</option>
            <option value="270">270日</option>
            <option value="300">300日</option>
            <option value="330">330日</option>
            <option value="360">360日</option>
        </select>
    </div>
    <div class="input-group">
        <label>支給残日数（日）</label>
        <input type="number" id="remainDays" placeholder="例: 65" inputmode="numeric" oninput="checkLimit()">
        <div id="errorMsg" style="color:#d32f2f; font-size:0.8rem; display:none; margin-top:5px;">※所定給付日数を超える入力はできません</div>
    </div>
    <div class="input-group">
        <label>基本手当日額（円）</label>
        <input type="number" id="dailyAmount" placeholder="例: 6000" inputmode="numeric">
    </div>
    <button onclick="calculateFinal()">計算を実行</button>
    <div id="resultArea" class="result-box">
        <div style="font-size:0.9rem;">給付率判定：<span id="rateLabel" style="font-weight:bold; color:#00529b;"></span></div>
        <div style="font-size:0.9rem; margin-top:10px;">支給概算額：</div>
        <div class="res-value" id="finalResult">0 円</div>
    </div>
    <div class="footer-note">
        【基本手当日額について】<br>
        離職した日の直前6ヶ月間に支払われた賃金の合計を180で割った金額（賃金日額）の約50〜80％（60歳〜64歳は45〜80％）となります。<br><br>
        ※正確な確定額は<span class="highlight">ハローワーク松山</span>が発行する<span class="highlight">「雇用保険受給資格者証」</span>にて通知されます。
    </div>
</div>
<script>
// ▼新しく追加した機能：入力制限チェック
function checkLimit() {
    const total = parseInt(document.getElementById('totalDays').value);
    const remainInput = document.getElementById('remainDays');
    const errorMsg = document.getElementById('errorMsg');
    
    // 入力値が存在し、かつ所定日数を超えていたら修正する
    if (remainInput.value && parseInt(remainInput.value) > total) {
        remainInput.value = total; // 強制的に上限値に書き換え
        remainInput.classList.add("error-border"); // 赤枠にする
        errorMsg.style.display = "block"; // エラーメッセージ表示
        
        // 1.5秒後に赤枠とメッセージを消す演出
        setTimeout(() => {
            remainInput.classList.remove("error-border");
            errorMsg.style.display = "none";
        }, 1500);
    }
}

function calculateFinal() {
    const age = document.getElementById('ageGroup').value;
    const total = parseFloat(document.getElementById('totalDays').value);
    const remain = parseFloat(document.getElementById('remainDays').value);
    let daily = parseFloat(document.getElementById('dailyAmount').value);
    
    // チェック：残日数が所定日数を超えていないか（念のため）
    if(remain > total) {
        alert("支給残日数は所定給付日数以下で入力してください");
        return;
    }

    if (!remain || !daily) { alert("入力してください"); return; }
    let cap = 0;
    if (age === "under30") cap = 7255;
    else if (age === "30to44") cap = 8055;
    else if (age === "45to59") cap = 8870;
    else if (age === "60to64") cap = 7623;
    if (daily > cap) daily = cap;
    let rate = 0;
    let rateText = "";
    const ratio = remain / total;
    if (ratio >= (2/3)) { rate = 0.7; rateText = "70%"; }
    else if (ratio >= (1/3)) { rate = 0.6; rateText = "60%"; }
    else { rateText = "支給対象外"; }
    const result = Math.floor(remain * rate * daily);
    document.getElementById('rateLabel').innerText = rateText;
    document.getElementById('finalResult').innerText = result.toLocaleString() + " 円";
    document.getElementById('resultArea').style.display = "block";
}
</script>
</body>
</html>
